--pending old order details -- need pick mod inventory -- need to seperate bulk from pickmod inv
select orm.order_number, det.item_number, det.qty, isnull(inv.inventory,0) as TotalInventory, isnull(pm.PickInv,0) as PickModInv,pick.order_number, pick.item_number, isnull(pick.status,0421) as PickdetStatus, pick.NotPicked
from t_order_detail det (nolock)
join t_order orm(nolock)
on det.order_number = orm.order_number
left outer join (
    select pic.order_number, pic.item_number, sum(pic.planned_quantity - picked_quantity) as NotPicked, pic.status
    from t_pick_detail pic(nolock)
    GROUP BY pic.order_number, pic.item_number, pic.status
    )pick
    ON det.order_number = pick.order_number
    AND det.item_number = pick.item_number
    
left outer join (
    select sum(sto.actual_qty) as inventory, sto.item_number
    from t_stored_item sto(nolock)
    where sto.type = '0'
    and sto.status = 'A'
    GROUP BY sto.item_number
    )inv
on det.item_number = inv.item_number
LEFT OUTER JOIN(
SELECT item_number, sum(isnull(actual_qty,0)) AS PickInv
FROM t_stored_item (nolock)
WHERE type = '0' 
AND (location_id LIKE 'AA%' OR location_id LIKE 'AB%' OR location_id LIKE 'AC%' OR location_id LIKE 'AD%') 
AND status = 'A' 
--AND item_number = '827088'
GROUP BY item_number
) pm
ON det.item_number = pm.item_number
WHERE orm.status NOT IN ('SHIPPED','CANCELLED','PACKED','LOADED','S','PROCESSING, 'SHIPPING')
      AND orm.order_type NOT IN ('RT','RTV','SM')
      AND cast(orm.order_date as date) > getdate() - 5
      --AND det.item_number = '665190'
GROUP BY orm.order_number, det.item_number, det.qty, isnull(inv.inventory,0), pick.order_number, pick.item_number, pick.status, pick.NotPicked, pm.PickInv
ORDER BY orm.order_number
